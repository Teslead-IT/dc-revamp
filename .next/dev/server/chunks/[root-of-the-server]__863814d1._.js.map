{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/server/database/sequelize.ts"],"sourcesContent":["import type { Sequelize as SequelizeType } from \"sequelize\"\r\n\r\n// Prevent Sequelize from being bundled into Next.js\r\nlet sequelize: SequelizeType | null = null\r\nlet isInitializing = false\r\n\r\n/**\r\n * Lazy initialize Sequelize with require\r\n * This prevents the pg driver from being loaded during Next.js build\r\n */\r\nasync function loadSequelize(): Promise<SequelizeType> {\r\n  if (sequelize) {\r\n    return sequelize\r\n  }\r\n\r\n  if (isInitializing) {\r\n    // Wait for initialization to complete\r\n    return new Promise((resolve) => {\r\n      const checkInterval = setInterval(() => {\r\n        if (sequelize) {\r\n          clearInterval(checkInterval)\r\n          resolve(sequelize!)\r\n        }\r\n      }, 50)\r\n    })\r\n  }\r\n\r\n  isInitializing = true\r\n\r\n  try {\r\n    // Use require to dynamically load Sequelize at runtime\r\n    // This ensures pg is only loaded when actually connecting to database\r\n    const Sequelize = require(\"sequelize\").Sequelize\r\n    const dialect = \"postgres\"\r\n    const env = process.env.NODE_ENV || \"development\"\r\n\r\n    if (process.env.DATABASE_URL) {\r\n      // Production: Use connection string\r\n      sequelize = new Sequelize(process.env.DATABASE_URL, {\r\n        dialect: dialect as any,\r\n        logging: env === \"development\" ? console.log : false,\r\n        pool: {\r\n          max: 10,\r\n          min: 2,\r\n          idle: 30000,\r\n          acquire: 30000,\r\n        },\r\n        ssl: env === \"production\",\r\n      })\r\n    } else {\r\n      // Development: Use individual environment variables\r\n      const dbHost = process.env.DB_HOST || \"localhost\"\r\n      const dbPort = parseInt(process.env.DB_PORT || \"5432\", 10)\r\n      const dbUser = process.env.DB_USER || \"postgres\"\r\n      const dbPassword = process.env.DB_PASSWORD || \"\"\r\n      const dbName = process.env.DB_NAME || \"teslead\"\r\n\r\n      if (env === \"development\") {\r\n        console.log(\"üì° Database Configuration:\")\r\n        console.log(`   Host: ${dbHost}`)\r\n        console.log(`   Port: ${dbPort}`)\r\n        console.log(`   User: ${dbUser}`)\r\n        console.log(`   Database: ${dbName}`)\r\n        console.log(`   Password: ${dbPassword ? \"******\" : \"(empty)\"}`)\r\n      }\r\n\r\n      sequelize = new Sequelize({\r\n        dialect: dialect as any,\r\n        host: dbHost,\r\n        port: dbPort,\r\n        username: dbUser,\r\n        password: dbPassword,\r\n        database: dbName,\r\n        logging: env === \"development\" ? console.log : false,\r\n        pool: {\r\n          max: 10,\r\n          min: 2,\r\n          idle: 30000,\r\n          acquire: 30000,\r\n        },\r\n      })\r\n    }\r\n\r\n    isInitializing = false\r\n    return sequelize\r\n  } catch (error: any) {\r\n    isInitializing = false\r\n    console.error(\"‚ùå Database connection error:\", error.message)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get or initialize Sequelize instance\r\n */\r\nexport async function getSequelize(): Promise<SequelizeType> {\r\n  if (!sequelize) {\r\n    return await loadSequelize()\r\n  }\r\n  return sequelize\r\n}\r\n\r\n/**\r\n * Initialize Sequelize with lazy loading\r\n */\r\nexport async function initializeSequelize(): Promise<SequelizeType> {\r\n  return getSequelize()\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEA,oDAAoD;AACpD,IAAI,YAAkC;AACtC,IAAI,iBAAiB;AAErB;;;CAGC,GACD,eAAe;IACb,IAAI,WAAW;QACb,OAAO;IACT;IAEA,IAAI,gBAAgB;QAClB,sCAAsC;QACtC,OAAO,IAAI,QAAQ,CAAC;YAClB,MAAM,gBAAgB,YAAY;gBAChC,IAAI,WAAW;oBACb,cAAc;oBACd,QAAQ;gBACV;YACF,GAAG;QACL;IACF;IAEA,iBAAiB;IAEjB,IAAI;QACF,uDAAuD;QACvD,sEAAsE;QACtE,MAAM,YAAY,kGAAqB,SAAS;QAChD,MAAM,UAAU;QAChB,MAAM,MAAM,mDAAwB;QAEpC,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAE;YAC5B,oCAAoC;YACpC,YAAY,IAAI,UAAU,QAAQ,GAAG,CAAC,YAAY,EAAE;gBAClD,SAAS;gBACT,SAAS,uCAAwB,QAAQ,GAAG,GAAG;gBAC/C,MAAM;oBACJ,KAAK;oBACL,KAAK;oBACL,MAAM;oBACN,SAAS;gBACX;gBACA,KAAK,QAAQ;YACf;QACF,OAAO;YACL,oDAAoD;YACpD,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YACtC,MAAM,SAAS,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ;YACvD,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YACtC,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW,IAAI;YAC9C,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YAEtC,wCAA2B;gBACzB,QAAQ,GAAG,CAAC;gBACZ,QAAQ,GAAG,CAAC,CAAC,SAAS,EAAE,QAAQ;gBAChC,QAAQ,GAAG,CAAC,CAAC,SAAS,EAAE,QAAQ;gBAChC,QAAQ,GAAG,CAAC,CAAC,SAAS,EAAE,QAAQ;gBAChC,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,QAAQ;gBACpC,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,aAAa,WAAW,WAAW;YACjE;YAEA,YAAY,IAAI,UAAU;gBACxB,SAAS;gBACT,MAAM;gBACN,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,UAAU;gBACV,SAAS,uCAAwB,QAAQ,GAAG,GAAG;gBAC/C,MAAM;oBACJ,KAAK;oBACL,KAAK;oBACL,MAAM;oBACN,SAAS;gBACX;YACF;QACF;QAEA,iBAAiB;QACjB,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,iBAAiB;QACjB,QAAQ,KAAK,CAAC,gCAAgC,MAAM,OAAO;QAC3D,MAAM;IACR;AACF;AAKO,eAAe;IACpB,IAAI,CAAC,WAAW;QACd,OAAO,MAAM;IACf;IACA,OAAO;AACT;AAKO,eAAe;IACpB,OAAO;AACT"}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/server/models/user.model.ts"],"sourcesContent":["import { DataTypes, Model, Optional, Sequelize } from \"sequelize\"\r\n\r\nexport interface UserAttributes {\r\n  id: string\r\n  userId: string\r\n  email: string\r\n  name: string\r\n  password: string\r\n  role: \"super_admin\" | \"admin\" | \"user\"\r\n  isActive: boolean\r\n  createdAt?: Date\r\n  updatedAt?: Date\r\n  deletedAt?: Date\r\n}\r\n\r\ninterface UserCreationAttributes extends Optional<UserAttributes, \"id\" | \"createdAt\" | \"updatedAt\" | \"deletedAt\"> {}\r\n\r\nexport class User extends Model<UserAttributes, UserCreationAttributes> implements UserAttributes {\r\n  public id!: string\r\n  public userId!: string\r\n  public email!: string\r\n  public name!: string\r\n  public password!: string\r\n  public role!: \"super_admin\" | \"admin\" | \"user\"\r\n  public isActive!: boolean\r\n\r\n  public readonly createdAt!: Date\r\n  public readonly updatedAt!: Date\r\n  public readonly deletedAt?: Date\r\n}\r\n\r\n/**\r\n * Initialize User model with sequelize instance\r\n * This is called lazily to avoid module loading issues\r\n */\r\nexport function initializeUserModel(sequelize: Sequelize): typeof User {\r\n  User.init(\r\n    {\r\n      id: {\r\n        type: DataTypes.UUID,\r\n        defaultValue: DataTypes.UUIDV4,\r\n        primaryKey: true,\r\n        allowNull: false,\r\n        unique: true,\r\n      },\r\n      userId: {\r\n        type: DataTypes.STRING(300),\r\n        allowNull: false,\r\n        unique: true,\r\n      },\r\n      email: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: false,\r\n        unique: true,\r\n        validate: {\r\n          isEmail: true,\r\n        },\r\n      },\r\n      name: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: false,\r\n      },\r\n      password: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: false,\r\n      },\r\n      role: {\r\n        type: DataTypes.ENUM(\"super_admin\", \"admin\", \"user\"),\r\n        allowNull: false,\r\n        defaultValue: \"user\",\r\n      },\r\n      isActive: {\r\n        type: DataTypes.BOOLEAN,\r\n        allowNull: false,\r\n        defaultValue: true,\r\n      },\r\n    },\r\n    {\r\n      sequelize,\r\n      modelName: \"User\",\r\n      tableName: \"users\",\r\n      timestamps: true,\r\n      paranoid: true, // Enables soft deletes\r\n      indexes: [\r\n        {\r\n          unique: true,\r\n          fields: [\"userId\"],\r\n        },\r\n        {\r\n          unique: true,\r\n          fields: [\"email\"],\r\n        },\r\n      ],\r\n      comment: \"Table for storing user details\",\r\n    }\r\n  )\r\n\r\n  return User\r\n}\r\n\r\nexport default User\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAiBO,MAAM,aAAa,qJAAK;IACtB,GAAW;IACX,OAAe;IACf,MAAc;IACd,KAAa;IACb,SAAiB;IACjB,KAAuC;IACvC,SAAkB;IAET,UAAgB;IAChB,UAAgB;IAChB,UAAgB;AAClC;AAMO,SAAS,oBAAoB,SAAoB;IACtD,KAAK,IAAI,CACP;QACE,IAAI;YACF,MAAM,yJAAS,CAAC,IAAI;YACpB,cAAc,yJAAS,CAAC,MAAM;YAC9B,YAAY;YACZ,WAAW;YACX,QAAQ;QACV;QACA,QAAQ;YACN,MAAM,yJAAS,CAAC,MAAM,CAAC;YACvB,WAAW;YACX,QAAQ;QACV;QACA,OAAO;YACL,MAAM,yJAAS,CAAC,MAAM,CAAC;YACvB,WAAW;YACX,QAAQ;YACR,UAAU;gBACR,SAAS;YACX;QACF;QACA,MAAM;YACJ,MAAM,yJAAS,CAAC,MAAM,CAAC;YACvB,WAAW;QACb;QACA,UAAU;YACR,MAAM,yJAAS,CAAC,MAAM,CAAC;YACvB,WAAW;QACb;QACA,MAAM;YACJ,MAAM,yJAAS,CAAC,IAAI,CAAC,eAAe,SAAS;YAC7C,WAAW;YACX,cAAc;QAChB;QACA,UAAU;YACR,MAAM,yJAAS,CAAC,OAAO;YACvB,WAAW;YACX,cAAc;QAChB;IACF,GACA;QACE;QACA,WAAW;QACX,WAAW;QACX,YAAY;QACZ,UAAU;QACV,SAAS;YACP;gBACE,QAAQ;gBACR,QAAQ;oBAAC;iBAAS;YACpB;YACA;gBACE,QAAQ;gBACR,QAAQ;oBAAC;iBAAQ;YACnB;SACD;QACD,SAAS;IACX;IAGF,OAAO;AACT;uCAEe"}},
    {"offset": {"line": 278, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/server/models/deliveryChallan.model.ts"],"sourcesContent":["import { DataTypes, Model, Optional, Sequelize } from \"sequelize\"\r\nimport type User from \"./user.model\"\r\n\r\nexport interface DeliveryChallanAttributes {\r\n  id: string\r\n  dcNumber: string\r\n  customerName: string\r\n  itemNames: string[]\r\n  totalDispatchQty: number\r\n  totalReceivedQty: number\r\n  status: \"draft\" | \"open\" | \"partial\" | \"closed\" | \"cancelled\" | \"deleted\"\r\n  createdBy: string\r\n  createdAt?: Date\r\n  updatedAt?: Date\r\n  deletedAt?: Date\r\n}\r\n\r\ninterface DeliveryChallanCreationAttributes extends Optional<DeliveryChallanAttributes, \"id\" | \"createdAt\" | \"updatedAt\" | \"deletedAt\"> {}\r\n\r\nexport class DeliveryChallan extends Model<DeliveryChallanAttributes, DeliveryChallanCreationAttributes> implements DeliveryChallanAttributes {\r\n  public id!: string\r\n  public dcNumber!: string\r\n  public customerName!: string\r\n  public itemNames!: string[]\r\n  public totalDispatchQty!: number\r\n  public totalReceivedQty!: number\r\n  public status!: \"draft\" | \"open\" | \"partial\" | \"closed\" | \"cancelled\" | \"deleted\"\r\n  public createdBy!: string\r\n\r\n  public readonly createdAt!: Date\r\n  public readonly updatedAt!: Date\r\n  public readonly deletedAt?: Date\r\n}\r\n\r\n/**\r\n * Initialize DeliveryChallan model with sequelize instance\r\n * This is called lazily to avoid module loading issues\r\n */\r\nexport function initializeDeliveryChallanModel(sequelize: Sequelize, User: typeof import(\"./user.model\").User): typeof DeliveryChallan {\r\n  DeliveryChallan.init(\r\n    {\r\n      id: {\r\n        type: DataTypes.UUID,\r\n        defaultValue: DataTypes.UUIDV4,\r\n        primaryKey: true,\r\n        allowNull: false,\r\n        unique: true,\r\n      },\r\n      dcNumber: {\r\n        type: DataTypes.STRING(300),\r\n        allowNull: false,\r\n        unique: true,\r\n      },\r\n      customerName: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: false,\r\n      },\r\n      itemNames: {\r\n        type: DataTypes.JSON,\r\n        allowNull: false,\r\n        defaultValue: [],\r\n      },\r\n      totalDispatchQty: {\r\n        type: DataTypes.INTEGER,\r\n        allowNull: false,\r\n        defaultValue: 0,\r\n        validate: {\r\n          min: 0,\r\n        },\r\n      },\r\n      totalReceivedQty: {\r\n        type: DataTypes.INTEGER,\r\n        allowNull: false,\r\n        defaultValue: 0,\r\n        validate: {\r\n          min: 0,\r\n        },\r\n      },\r\n      status: {\r\n        type: DataTypes.ENUM(\"draft\", \"open\", \"partial\", \"closed\", \"cancelled\", \"deleted\"),\r\n        allowNull: false,\r\n        defaultValue: \"draft\",\r\n      },\r\n      createdBy: {\r\n        type: DataTypes.UUID,\r\n        allowNull: false,\r\n        references: {\r\n          model: User,\r\n          key: \"id\",\r\n        },\r\n      },\r\n    },\r\n    {\r\n      sequelize,\r\n      modelName: \"DeliveryChallan\",\r\n      tableName: \"delivery_challans\",\r\n      timestamps: true,\r\n      paranoid: true, // Enables soft deletes\r\n      indexes: [\r\n        {\r\n          unique: true,\r\n          fields: [\"dcNumber\"],\r\n        },\r\n        {\r\n          fields: [\"createdBy\"],\r\n        },\r\n        {\r\n          fields: [\"status\"],\r\n        },\r\n      ],\r\n      comment: \"Table for storing delivery challan details\",\r\n    }\r\n  )\r\n\r\n  return DeliveryChallan\r\n}\r\n\r\nexport default DeliveryChallan\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAmBO,MAAM,wBAAwB,qJAAK;IACjC,GAAW;IACX,SAAiB;IACjB,aAAqB;IACrB,UAAoB;IACpB,iBAAyB;IACzB,iBAAyB;IACzB,OAA0E;IAC1E,UAAkB;IAET,UAAgB;IAChB,UAAgB;IAChB,UAAgB;AAClC;AAMO,SAAS,+BAA+B,SAAoB,EAAE,IAAwC;IAC3G,gBAAgB,IAAI,CAClB;QACE,IAAI;YACF,MAAM,yJAAS,CAAC,IAAI;YACpB,cAAc,yJAAS,CAAC,MAAM;YAC9B,YAAY;YACZ,WAAW;YACX,QAAQ;QACV;QACA,UAAU;YACR,MAAM,yJAAS,CAAC,MAAM,CAAC;YACvB,WAAW;YACX,QAAQ;QACV;QACA,cAAc;YACZ,MAAM,yJAAS,CAAC,MAAM,CAAC;YACvB,WAAW;QACb;QACA,WAAW;YACT,MAAM,yJAAS,CAAC,IAAI;YACpB,WAAW;YACX,cAAc,EAAE;QAClB;QACA,kBAAkB;YAChB,MAAM,yJAAS,CAAC,OAAO;YACvB,WAAW;YACX,cAAc;YACd,UAAU;gBACR,KAAK;YACP;QACF;QACA,kBAAkB;YAChB,MAAM,yJAAS,CAAC,OAAO;YACvB,WAAW;YACX,cAAc;YACd,UAAU;gBACR,KAAK;YACP;QACF;QACA,QAAQ;YACN,MAAM,yJAAS,CAAC,IAAI,CAAC,SAAS,QAAQ,WAAW,UAAU,aAAa;YACxE,WAAW;YACX,cAAc;QAChB;QACA,WAAW;YACT,MAAM,yJAAS,CAAC,IAAI;YACpB,WAAW;YACX,YAAY;gBACV,OAAO;gBACP,KAAK;YACP;QACF;IACF,GACA;QACE;QACA,WAAW;QACX,WAAW;QACX,YAAY;QACZ,UAAU;QACV,SAAS;YACP;gBACE,QAAQ;gBACR,QAAQ;oBAAC;iBAAW;YACtB;YACA;gBACE,QAAQ;oBAAC;iBAAY;YACvB;YACA;gBACE,QAAQ;oBAAC;iBAAS;YACpB;SACD;QACD,SAAS;IACX;IAGF,OAAO;AACT;uCAEe"}},
    {"offset": {"line": 386, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/server/models/index.ts"],"sourcesContent":["import User, { initializeUserModel } from \"./user.model\"\r\nimport DeliveryChallan, { initializeDeliveryChallanModel } from \"./deliveryChallan.model\"\r\nimport type { Sequelize } from \"sequelize\"\r\n\r\ntype SyncOptions = {\r\n  alter?: boolean\r\n  force?: boolean\r\n}\r\n\r\nlet isInitialized = false\r\n\r\n/**\r\n * Initialize all models with sequelize instance\r\n * This must be called once before using any models\r\n */\r\nexport function initializeModels(sequelize: Sequelize) {\r\n  if (isInitialized) {\r\n    return\r\n  }\r\n\r\n  initializeUserModel(sequelize)\r\n  initializeDeliveryChallanModel(sequelize, User)\r\n\r\n  isInitialized = true\r\n}\r\n\r\n/**\r\n * Initialize model associations\r\n */\r\nexport function initializeAssociations() {\r\n  // User associations\r\n  User.hasMany(DeliveryChallan, {\r\n    foreignKey: \"createdBy\",\r\n    as: \"deliveryChalans\",\r\n  })\r\n\r\n  DeliveryChallan.belongsTo(User, {\r\n    foreignKey: \"createdBy\",\r\n    as: \"creator\",\r\n  })\r\n}\r\n\r\n/**\r\n * Syncs the Sequelize models in order of dependencies\r\n */\r\nexport async function syncDatabase(options: SyncOptions = { alter: true }) {\r\n  try {\r\n    console.log(\"üîÅ Starting database sync...\")\r\n\r\n    // 1. Core tables (no dependencies)\r\n    await User.sync(options)\r\n    console.log(\"‚úÖ User table synced successfully.\")\r\n\r\n    // 2. App tables (with foreign keys)\r\n    await DeliveryChallan.sync(options)\r\n    console.log(\"‚úÖ DeliveryChallan table synced successfully.\")\r\n\r\n    console.log(\"üéâ Database sync completed successfully.\")\r\n  } catch (error) {\r\n    console.error(\"‚ùå Error syncing database:\", error)\r\n  }\r\n}\r\n\r\n/**\r\n * Sync a single model\r\n */\r\nexport const singleModelSync = async (model: any, options: SyncOptions = { alter: true }) => {\r\n  try {\r\n    console.log(`üîÅ Syncing model: ${model.name}`)\r\n    await model.sync(options)\r\n    console.log(`‚úÖ Model ${model.name} synced successfully.`)\r\n  } catch (error) {\r\n    console.error(`‚ùå Error syncing model ${model.name}:`, error)\r\n  }\r\n}\r\n\r\n// Export models\r\nexport { User, DeliveryChallan }\r\n\r\n// Export types\r\nexport type { UserAttributes } from \"./user.model\"\r\nexport type { DeliveryChallanAttributes } from \"./deliveryChallan.model\"\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAQA,IAAI,gBAAgB;AAMb,SAAS,iBAAiB,SAAoB;IACnD,IAAI,eAAe;QACjB;IACF;IAEA,IAAA,0JAAmB,EAAC;IACpB,IAAA,gLAA8B,EAAC,WAAW,8IAAI;IAE9C,gBAAgB;AAClB;AAKO,SAAS;IACd,oBAAoB;IACpB,8IAAI,CAAC,OAAO,CAAC,yJAAe,EAAE;QAC5B,YAAY;QACZ,IAAI;IACN;IAEA,yJAAe,CAAC,SAAS,CAAC,8IAAI,EAAE;QAC9B,YAAY;QACZ,IAAI;IACN;AACF;AAKO,eAAe,aAAa,UAAuB;IAAE,OAAO;AAAK,CAAC;IACvE,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,mCAAmC;QACnC,MAAM,8IAAI,CAAC,IAAI,CAAC;QAChB,QAAQ,GAAG,CAAC;QAEZ,oCAAoC;QACpC,MAAM,yJAAe,CAAC,IAAI,CAAC;QAC3B,QAAQ,GAAG,CAAC;QAEZ,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;IAC7C;AACF;AAKO,MAAM,kBAAkB,OAAO,OAAY,UAAuB;IAAE,OAAO;AAAK,CAAC;IACtF,IAAI;QACF,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,MAAM,IAAI,EAAE;QAC7C,MAAM,MAAM,IAAI,CAAC;QACjB,QAAQ,GAAG,CAAC,CAAC,QAAQ,EAAE,MAAM,IAAI,CAAC,qBAAqB,CAAC;IAC1D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,MAAM,IAAI,CAAC,CAAC,CAAC,EAAE;IACxD;AACF"}},
    {"offset": {"line": 452, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/server/database/index.ts"],"sourcesContent":["import { getSequelize, initializeSequelize } from \"./sequelize\"\r\nimport { syncDatabase, initializeAssociations, initializeModels } from \"../models\"\r\n\r\nexport interface DBConnection {\r\n  sequelize: any\r\n}\r\n\r\nlet db: DBConnection | null = null\r\n\r\nexport async function initializeDatabase(): Promise<DBConnection> {\r\n  if (db) {\r\n    return db\r\n  }\r\n\r\n  try {\r\n    const sequelize = await getSequelize()\r\n    \r\n    // Initialize models with sequelize instance\r\n    initializeModels(sequelize)\r\n    \r\n    // Test connection\r\n    await sequelize.authenticate()\r\n    console.log(\"‚úÖ Database connection established successfully\")\r\n\r\n    // Initialize associations\r\n    initializeAssociations()\r\n    console.log(\"‚úÖ Model associations initialized\")\r\n\r\n    // Sync database (use alter: true for development, force: false for production)\r\n    const env = process.env.NODE_ENV || \"development\"\r\n    await syncDatabase({\r\n      alter: env === \"development\",\r\n      force: false,\r\n    })\r\n\r\n    db = {\r\n      sequelize,\r\n    }\r\n\r\n    return db\r\n  } catch (error) {\r\n    console.error(\"‚ùå Unable to connect to the database:\", error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function getDatabase(): Promise<DBConnection> {\r\n  if (db) {\r\n    return db\r\n  }\r\n  return await initializeDatabase()\r\n}\r\n\r\nexport { getSequelize, initializeSequelize }\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAMA,IAAI,KAA0B;AAEvB,eAAe;IACpB,IAAI,IAAI;QACN,OAAO;IACT;IAEA,IAAI;QACF,MAAM,YAAY,MAAM,IAAA,iJAAY;QAEpC,4CAA4C;QAC5C,IAAA,+JAAgB,EAAC;QAEjB,kBAAkB;QAClB,MAAM,UAAU,YAAY;QAC5B,QAAQ,GAAG,CAAC;QAEZ,0BAA0B;QAC1B,IAAA,qKAAsB;QACtB,QAAQ,GAAG,CAAC;QAEZ,+EAA+E;QAC/E,MAAM,MAAM,mDAAwB;QACpC,MAAM,IAAA,2JAAY,EAAC;YACjB,OAAO,QAAQ;YACf,OAAO;QACT;QAEA,KAAK;YACH;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,MAAM;IACR;AACF;AAEO,eAAe;IACpB,IAAI,IAAI;QACN,OAAO;IACT;IACA,OAAO,MAAM;AACf"}},
    {"offset": {"line": 515, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/server/middleware/auth.middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport jwt from \"jsonwebtoken\"\r\n\r\nexport interface TokenPayload {\r\n  id: string\r\n  userId: string\r\n  email: string\r\n  name: string\r\n  role: \"super_admin\" | \"admin\" | \"user\"\r\n  iat: number\r\n  exp: number\r\n}\r\n\r\n/**\r\n * Verify JWT token\r\n */\r\nexport const verifyToken = (token: string): TokenPayload | null => {\r\n  try {\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET || \"your_jwt_secret\") as TokenPayload\r\n    return decoded\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Generate Access Token (expires in 1 hour)\r\n */\r\nexport const generateAccessToken = (payload: Omit<TokenPayload, \"iat\" | \"exp\">): string => {\r\n  return jwt.sign(payload, process.env.JWT_SECRET || \"your_jwt_secret\", {\r\n    expiresIn: \"1h\",\r\n  })\r\n}\r\n\r\n/**\r\n * Generate Refresh Token (expires in 7 days)\r\n */\r\nexport const generateRefreshToken = (payload: Omit<TokenPayload, \"iat\" | \"exp\">): string => {\r\n  return jwt.sign(payload, process.env.JWT_REFRESH_SECRET || \"your_refresh_secret\", {\r\n    expiresIn: \"7d\",\r\n  })\r\n}\r\n\r\n/**\r\n * Verify Refresh Token\r\n */\r\nexport const verifyRefreshToken = (token: string): TokenPayload | null => {\r\n  try {\r\n    const decoded = jwt.verify(token, process.env.JWT_REFRESH_SECRET || \"your_refresh_secret\") as TokenPayload\r\n    return decoded\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Authentication Middleware - Extracts and validates token\r\n */\r\nexport const authMiddleware = async (request: NextRequest) => {\r\n  const token = extractToken(request)\r\n\r\n  if (!token) {\r\n    return {\r\n      authenticated: false,\r\n      payload: null,\r\n      error: \"No token provided\",\r\n    }\r\n  }\r\n\r\n  const payload = verifyToken(token)\r\n\r\n  if (!payload) {\r\n    return {\r\n      authenticated: false,\r\n      payload: null,\r\n      error: \"Invalid or expired token\",\r\n    }\r\n  }\r\n\r\n  return {\r\n    authenticated: true,\r\n    payload,\r\n    error: null,\r\n  }\r\n}\r\n\r\n/**\r\n * Extract token from Authorization header\r\n */\r\nexport const extractToken = (request: NextRequest): string | null => {\r\n  const authHeader = request.headers.get(\"authorization\")\r\n\r\n  if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n    return null\r\n  }\r\n\r\n  return authHeader.substring(7)\r\n}\r\n\r\n/**\r\n * Role-based Access Control (RBAC) checker\r\n */\r\nexport const checkRole = (userRole: string, allowedRoles: string[]): boolean => {\r\n  return allowedRoles.includes(userRole)\r\n}\r\n\r\n/**\r\n * Unauthorized Response\r\n */\r\nexport const unauthorizedResponse = (message: string = \"Unauthorized\") => {\r\n  return NextResponse.json({ error: message }, { status: 401 })\r\n}\r\n\r\n/**\r\n * Forbidden Response (authenticated but no permission)\r\n */\r\nexport const forbiddenResponse = (message: string = \"Forbidden\") => {\r\n  return NextResponse.json({ error: message }, { status: 403 })\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;;;AAeO,MAAM,cAAc,CAAC;IAC1B,IAAI;QACF,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;QAC5D,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAKO,MAAM,sBAAsB,CAAC;IAClC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI,mBAAmB;QACpE,WAAW;IACb;AACF;AAKO,MAAM,uBAAuB,CAAC;IACnC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,QAAQ,GAAG,CAAC,kBAAkB,IAAI,uBAAuB;QAChF,WAAW;IACb;AACF;AAKO,MAAM,qBAAqB,CAAC;IACjC,IAAI;QACF,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,kBAAkB,IAAI;QACpE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAKO,MAAM,iBAAiB,OAAO;IACnC,MAAM,QAAQ,aAAa;IAE3B,IAAI,CAAC,OAAO;QACV,OAAO;YACL,eAAe;YACf,SAAS;YACT,OAAO;QACT;IACF;IAEA,MAAM,UAAU,YAAY;IAE5B,IAAI,CAAC,SAAS;QACZ,OAAO;YACL,eAAe;YACf,SAAS;YACT,OAAO;QACT;IACF;IAEA,OAAO;QACL,eAAe;QACf;QACA,OAAO;IACT;AACF;AAKO,MAAM,eAAe,CAAC;IAC3B,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEvC,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;QACpD,OAAO;IACT;IAEA,OAAO,WAAW,SAAS,CAAC;AAC9B;AAKO,MAAM,YAAY,CAAC,UAAkB;IAC1C,OAAO,aAAa,QAAQ,CAAC;AAC/B;AAKO,MAAM,uBAAuB,CAAC,UAAkB,cAAc;IACnE,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE,QAAQ;IAAI;AAC7D;AAKO,MAAM,oBAAoB,CAAC,UAAkB,WAAW;IAC7D,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE,QAAQ;IAAI;AAC7D"}},
    {"offset": {"line": 616, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/server/auth.ts"],"sourcesContent":["// Server-side JWT Authentication utilities\r\nimport { initializeDatabase } from \"./database\"\r\nimport User from \"./models/user.model\"\r\nimport { generateAccessToken, generateRefreshToken } from \"./middleware/auth.middleware\"\r\n\r\nexport interface UserData {\r\n  id: string\r\n  userId: string\r\n  name: string\r\n  email: string\r\n  role: \"super_admin\" | \"admin\" | \"user\"\r\n}\r\n\r\nexport interface AuthResponse {\r\n  success: boolean\r\n  message: string\r\n  user?: UserData\r\n  accessToken?: string\r\n  refreshToken?: string\r\n}\r\n\r\n/**\r\n * Verify if userId exists in database\r\n * Server-only function\r\n */\r\nexport async function verifyUserId(userId: string): Promise<{ exists: boolean; message: string }> {\r\n  try {\r\n    await initializeDatabase()\r\n    const user = await User.findOne({\r\n      where: { userId },\r\n    })\r\n\r\n    if (user) {\r\n      return { exists: true, message: \"User found\" }\r\n    }\r\n    return { exists: false, message: \"User ID not found\" }\r\n  } catch (error) {\r\n    console.error(\"Error verifying user ID:\", error)\r\n    return { exists: false, message: \"Database error\" }\r\n  }\r\n}\r\n\r\n/**\r\n * Verify password for userId and generate JWT tokens\r\n * Server-only function\r\n */\r\nexport async function verifyPassword(userId: string, password: string): Promise<AuthResponse> {\r\n  try {\r\n    await initializeDatabase()\r\n\r\n    const user = await User.findOne({\r\n      where: { userId },\r\n    })\r\n\r\n    if (!user) {\r\n      return { success: false, message: \"Invalid credentials\" }\r\n    }\r\n\r\n    // Simple password comparison (in production, use bcrypt)\r\n    if (user.getDataValue(\"password\") !== password) {\r\n      return { success: false, message: \"Invalid credentials\" }\r\n    }\r\n\r\n    // Check if user is active\r\n    if (!user.getDataValue(\"isActive\")) {\r\n      return { success: false, message: \"User account is inactive\" }\r\n    }\r\n\r\n    const userData: UserData = {\r\n      id: user.getDataValue(\"id\"),\r\n      userId: user.getDataValue(\"userId\"),\r\n      name: user.getDataValue(\"name\"),\r\n      email: user.getDataValue(\"email\"),\r\n      role: user.getDataValue(\"role\"),\r\n    }\r\n\r\n    // Generate JWT tokens\r\n    const accessToken = generateAccessToken({\r\n      id: userData.id,\r\n      userId: userData.userId,\r\n      email: userData.email,\r\n      name: userData.name,\r\n      role: userData.role,\r\n    })\r\n\r\n    const refreshToken = generateRefreshToken({\r\n      id: userData.id,\r\n      userId: userData.userId,\r\n      email: userData.email,\r\n      name: userData.name,\r\n      role: userData.role,\r\n    })\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Login successful\",\r\n      user: userData,\r\n      accessToken,\r\n      refreshToken,\r\n    }\r\n  } catch (error: any) {\r\n    console.error(\"Auth error:\", error)\r\n    return { success: false, message: \"Authentication error\" }\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,2CAA2C;;;;;;;AAC3C;AACA;AACA;;;;AAsBO,eAAe,aAAa,MAAc;IAC/C,IAAI;QACF,MAAM,IAAA,mKAAkB;QACxB,MAAM,OAAO,MAAM,8IAAI,CAAC,OAAO,CAAC;YAC9B,OAAO;gBAAE;YAAO;QAClB;QAEA,IAAI,MAAM;YACR,OAAO;gBAAE,QAAQ;gBAAM,SAAS;YAAa;QAC/C;QACA,OAAO;YAAE,QAAQ;YAAO,SAAS;QAAoB;IACvD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,QAAQ;YAAO,SAAS;QAAiB;IACpD;AACF;AAMO,eAAe,eAAe,MAAc,EAAE,QAAgB;IACnE,IAAI;QACF,MAAM,IAAA,mKAAkB;QAExB,MAAM,OAAO,MAAM,8IAAI,CAAC,OAAO,CAAC;YAC9B,OAAO;gBAAE;YAAO;QAClB;QAEA,IAAI,CAAC,MAAM;YACT,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAsB;QAC1D;QAEA,yDAAyD;QACzD,IAAI,KAAK,YAAY,CAAC,gBAAgB,UAAU;YAC9C,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAsB;QAC1D;QAEA,0BAA0B;QAC1B,IAAI,CAAC,KAAK,YAAY,CAAC,aAAa;YAClC,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAA2B;QAC/D;QAEA,MAAM,WAAqB;YACzB,IAAI,KAAK,YAAY,CAAC;YACtB,QAAQ,KAAK,YAAY,CAAC;YAC1B,MAAM,KAAK,YAAY,CAAC;YACxB,OAAO,KAAK,YAAY,CAAC;YACzB,MAAM,KAAK,YAAY,CAAC;QAC1B;QAEA,sBAAsB;QACtB,MAAM,cAAc,IAAA,mKAAmB,EAAC;YACtC,IAAI,SAAS,EAAE;YACf,QAAQ,SAAS,MAAM;YACvB,OAAO,SAAS,KAAK;YACrB,MAAM,SAAS,IAAI;YACnB,MAAM,SAAS,IAAI;QACrB;QAEA,MAAM,eAAe,IAAA,oKAAoB,EAAC;YACxC,IAAI,SAAS,EAAE;YACf,QAAQ,SAAS,MAAM;YACvB,OAAO,SAAS,KAAK;YACrB,MAAM,SAAS,IAAI;YACnB,MAAM,SAAS,IAAI;QACrB;QAEA,OAAO;YACL,SAAS;YACT,SAAS;YACT,MAAM;YACN;YACA;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO;YAAE,SAAS;YAAO,SAAS;QAAuB;IAC3D;AACF"}},
    {"offset": {"line": 724, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Teslead/Nextjs/next-js-dashboard-with-backend/app/api/auth/verify-user/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { verifyUserId } from \"@/server/auth\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { userId } = await request.json()\n\n    if (!userId) {\n      return NextResponse.json({ success: false, message: \"User ID is required\" }, { status: 400 })\n    }\n\n    const result = await verifyUserId(userId)\n\n    return NextResponse.json({\n      success: result.exists,\n      message: result.message,\n      data: { exists: result.exists },\n    })\n  } catch (error) {\n    return NextResponse.json({ success: false, message: \"Server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAErC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC7F;QAEA,MAAM,SAAS,MAAM,IAAA,gIAAY,EAAC;QAElC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS,OAAO,MAAM;YACtB,SAAS,OAAO,OAAO;YACvB,MAAM;gBAAE,QAAQ,OAAO,MAAM;YAAC;QAChC;IACF,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtF;AACF"}}]
}